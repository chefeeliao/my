<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>趣味数学练习 - 小学生数学乐园</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- GSAP 动画库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4A9DFF',
                        secondary: '#FFD54F',
                        success: '#4CAF50',
                        danger: '#F44336',
                        warning: '#FF9800',
                        info: '#2196F3',
                        light: '#FFF9C4',
                        dark: '#5D4037'
                    },
                    fontFamily: {
                        sans: ['Comic Sans MS', 'Arial', 'sans-serif'],
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            }
            .text-shadow-lg {
                text-shadow: 4px 4px 8px rgba(0,0,0,0.3);
            }
            .btn-pop {
                @apply transform transition-transform duration-150;
            }
            .btn-pop:hover {
                @apply scale-105;
            }
            .btn-pop:active {
                @apply scale-95;
            }
            .star-glow {
                filter: drop-shadow(0 0 5px #FFD700);
            }
        }
    </style>
    
    <style>
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 12px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #4A9DFF;
            border-radius: 10px;
            border: 3px solid #f1f1f1;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #357ABD;
        }
        
        /* 数字跳动动画 */
        @keyframes countUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .count-animation {
            animation: countUp 0.5s ease-out forwards;
        }
        
        /* 题目出现动画 */
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        
        /* 星星闪烁 */
        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .twinkle {
            animation: twinkle 1s ease-in-out infinite;
        }
        
        /* 正确答案动画 */
        @keyframes correctAnswer {
            0% { background-color: transparent; }
            50% { background-color: rgba(76, 175, 80, 0.3); }
            100% { background-color: transparent; }
        }
        
        .correct-animation {
            animation: correctAnswer 1s ease-in-out;
        }
        
        /* 错误答案动画 */
        @keyframes wrongAnswer {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }
        
        .wrong-animation {
            animation: wrongAnswer 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gradient-to-b from-blue-100 to-purple-100 min-h-screen">
    <!-- 顶部导航 -->
    <header class="bg-gradient-to-r from-primary to-info text-white shadow-lg">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center">
                <i class="fa fa-calculator text-3xl mr-3 text-secondary"></i>
                <h1 class="text-2xl md:text-3xl font-bold text-shadow">趣味数学练习</h1>
            </div>
            <div class="text-lg font-semibold">
                <i class="fa fa-star text-secondary mr-1"></i>
                <span id="totalScore">0</span> 分
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-8">
        <!-- 开始界面 -->
        <div id="startScreen" class="flex flex-col items-center justify-center min-h-[60vh]">
            <div class="text-center mb-8">
                <h2 class="text-4xl md:text-5xl font-bold text-primary mb-4 text-shadow-lg animate-float">
                    欢迎来到数学乐园！
                </h2>
                <p class="text-xl text-gray-700 mb-6">
                    点击下面的按钮，开始你的数学冒险吧！
                </p>
            </div>
            
            <div class="relative mb-12">
                <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/aaee1274a0534f80a9dfa1bf090b436a~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601161755478BC4EB34DD7E510F9AC8&rrcfp=f06b921b&x-expires=1771149393&x-signature=m8KtBEeL3exyTQ2nYdVp5%2FNsUmY%3D" 
                     alt="数学老师" 
                     class="w-48 h-48 object-contain animate-float">
                <div class="absolute -top-4 -right-4 bg-secondary text-white rounded-full w-16 h-16 flex items-center justify-center text-2xl font-bold transform rotate-12 shadow-lg">
                    你好！
                </div>
            </div>
            
            <button id="startBtn" class="btn-pop bg-gradient-to-r from-primary to-info text-white text-2xl font-bold py-4 px-12 rounded-full shadow-xl hover:shadow-2xl transition-all duration-300">
                <i class="fa fa-play-circle mr-3"></i>
                开始练习
            </button>
        </div>

        <!-- 题目界面 -->
        <div id="quizScreen" class="hidden">
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-primary">
                        <i class="fa fa-pencil-square-o mr-2"></i>
                        数学题目
                    </h2>
                    <div class="text-lg font-semibold text-gray-700">
                        题目 <span id="currentQuestion">1</span>/5
                    </div>
                </div>
                
                <!-- 难度星级 -->
                <div id="difficultyStars" class="flex justify-center mb-6">
                    <!-- 星级将动态生成 -->
                </div>
                
                <!-- 题目内容 -->
                <div id="questionContainer" class="mb-8">
                    <div id="questionText" class="text-2xl md:text-3xl font-bold text-center mb-6 p-4 bg-light rounded-xl shadow-inner">
                        <!-- 题目将动态生成 -->
                    </div>
                    
                    <!-- 答题区域 -->
                    <div class="flex flex-col md:flex-row items-center justify-center gap-4 mb-6">
                        <input type="text" id="answerInput" 
                               class="w-full md:w-64 text-2xl text-center border-4 border-primary rounded-xl p-4 focus:outline-none focus:border-info transition-colors duration-300"
                               placeholder="请输入答案">
                        <button id="submitAnswerBtn" class="btn-pop bg-success text-white text-xl font-bold py-4 px-8 rounded-full shadow-lg hover:shadow-xl transition-all duration-300">
                            <i class="fa fa-check-circle mr-2"></i>
                            提交答案
                        </button>
                    </div>
                    
                    <!-- 提示信息 -->
                    <div id="hintText" class="text-center text-gray-600 italic hidden">
                        提示：仔细想想哦！
                    </div>
                </div>
                
                <!-- 解析区域 -->
                <div id="explanationContainer" class="hidden bg-blue-50 rounded-xl p-6 border-2 border-info">
                    <h3 class="text-xl font-bold text-info mb-3">
                        <i class="fa fa-lightbulb-o mr-2"></i>
                        题目解析
                    </h3>
                    <div id="explanationText" class="text-gray-700 mb-4">
                        <!-- 解析将动态生成 -->
                    </div>
                    <button id="nextQuestionBtn" class="btn-pop bg-info text-white font-bold py-3 px-6 rounded-full shadow-md hover:shadow-lg transition-all duration-300 w-full md:w-auto">
                        <i class="fa fa-arrow-right mr-2"></i>
                        下一题
                    </button>
                </div>
            </div>
        </div>

        <!-- 结果界面 -->
        <div id="resultScreen" class="hidden text-center">
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
                <div class="mb-8">
                    <h2 class="text-4xl font-bold text-primary mb-4 text-shadow-lg">
                        练习完成！
                    </h2>
                    <p class="text-xl text-gray-700 mb-2">
                        你真棒！完成了所有题目
                    </p>
                </div>
                
                <div class="mb-8">
                    <div class="text-6xl font-bold text-primary mb-2 count-animation" id="finalScore">
                        0
                    </div>
                    <p class="text-xl text-gray-600">
                        总分：50 分
                    </p>
                </div>
                
                <div id="resultMessage" class="mb-8 text-xl font-semibold">
                    <!-- 结果消息将动态生成 -->
                </div>
                
                <div class="flex flex-col md:flex-row gap-4 justify-center">
                    <button id="restartBtn" class="btn-pop bg-primary text-white text-xl font-bold py-4 px-8 rounded-full shadow-lg hover:shadow-xl transition-all duration-300">
                        <i class="fa fa-refresh mr-2"></i>
                        重新开始
                    </button>
                    <button id="viewAnswersBtn" class="btn-pop bg-secondary text-dark text-xl font-bold py-4 px-8 rounded-full shadow-lg hover:shadow-xl transition-all duration-300">
                        <i class="fa fa-list-alt mr-2"></i>
                        查看答案
                    </button>
                </div>
            </div>
            
            <!-- 答案回顾 -->
            <div id="answersReview" class="hidden bg-white rounded-2xl shadow-xl p-8">
                <h3 class="text-2xl font-bold text-primary mb-6">
                    <i class="fa fa-history mr-2"></i>
                    题目回顾
                </h3>
                <div id="answersList" class="space-y-6">
                    <!-- 答案列表将动态生成 -->
                </div>
            </div>
        </div>
    </main>

    <!-- 底部信息 -->
    <footer class="bg-dark text-white py-6">
        <div class="container mx-auto px-4 text-center">
            <p class="mb-2">
                <i class="fa fa-heart text-danger mr-2"></i>
                小学生数学乐园 - 让学习更有趣！
            </p>
            <p class="text-sm text-gray-300">
                适合 6-12 岁小学生使用
            </p>
        </div>
    </footer>

    <!-- 音效控制 -->
    <div class="fixed bottom-4 right-4">
        <button id="soundToggle" class="btn-pop bg-white text-primary w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-xl">
            <i class="fa fa-volume-up"></i>
        </button>
    </div>

    <script>
        // 全局变量
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let totalScore = 0;
        let soundEnabled = true;
        let userAnswers = [];
        
        // DOM元素
        const startScreen = document.getElementById('startScreen');
        const quizScreen = document.getElementById('quizScreen');
        const resultScreen = document.getElementById('resultScreen');
        const answersReview = document.getElementById('answersReview');
        
        const startBtn = document.getElementById('startBtn');
        const submitAnswerBtn = document.getElementById('submitAnswerBtn');
        const nextQuestionBtn = document.getElementById('nextQuestionBtn');
        const restartBtn = document.getElementById('restartBtn');
        const viewAnswersBtn = document.getElementById('viewAnswersBtn');
        const soundToggle = document.getElementById('soundToggle');
        
        const questionText = document.getElementById('questionText');
        const answerInput = document.getElementById('answerInput');
        const hintText = document.getElementById('hintText');
        const explanationContainer = document.getElementById('explanationContainer');
        const explanationText = document.getElementById('explanationText');
        const difficultyStars = document.getElementById('difficultyStars');
        const currentQuestionSpan = document.getElementById('currentQuestion');
        const totalScoreSpan = document.getElementById('totalScore');
        const finalScoreSpan = document.getElementById('finalScore');
        const resultMessage = document.getElementById('resultMessage');
        const answersList = document.getElementById('answersList');
        
        // 音效
        const correctSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3');
        const wrongSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');
        const successSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3');
        const buttonSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-modern-technology-select-3124.mp3');
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            animateStartScreen();
        });
        
        // 设置事件监听
        function setupEventListeners() {
            startBtn.addEventListener('click', startQuiz);
            submitAnswerBtn.addEventListener('click', checkAnswer);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            restartBtn.addEventListener('click', restartQuiz);
            viewAnswersBtn.addEventListener('click', toggleAnswersReview);
            soundToggle.addEventListener('click', toggleSound);
            
            answerInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
            
            // 点击提示显示
            hintText.addEventListener('click', () => {
                showHint();
            });
        }
        
        // 开始界面动画
        function animateStartScreen() {
            gsap.from('.animate-float', {
                y: 50,
                opacity: 0,
                duration: 1,
                ease: 'back.out(1.7)'
            });
            
            gsap.from('h2', {
                scale: 0.5,
                opacity: 0,
                duration: 0.8,
                delay: 0.3,
                ease: 'power2.out'
            });
            
            gsap.from('p', {
                y: 20,
                opacity: 0,
                duration: 0.8,
                delay: 0.6,
                ease: 'power2.out'
            });
            
            gsap.from('#startBtn', {
                scale: 0,
                rotation: -180,
                opacity: 0,
                duration: 1,
                delay: 0.9,
                ease: 'elastic.out(1, 0.5)'
            });
        }
        
        // 开始练习
        function startQuiz() {
            playSound(buttonSound);
            
            // 生成题目
            generateQuestions();
            
            // 重置分数
            score = 0;
            totalScore = 0;
            currentQuestionIndex = 0;
            userAnswers = [];
            
            // 更新总分显示
            totalScoreSpan.textContent = totalScore;
            
            // 隐藏开始界面，显示题目界面
            gsap.timeline()
                .to(startScreen, {
                    opacity: 0,
                    y: -50,
                    duration: 0.5,
                    ease: 'power2.in'
                })
                .to(quizScreen, {
                    opacity: 1,
                    y: 0,
                    duration: 0.5,
                    ease: 'power2.out',
                    onComplete: () => {
                        startScreen.classList.add('hidden');
                        quizScreen.classList.remove('hidden');
                        showQuestion(0);
                    }
                });
        }
        
        // 生成5道不同类型的题目
        function generateQuestions() {
            currentQuestions = [];
            
            // 1. 简单四则运算（1星）
            currentQuestions.push(generateArithmeticQuestion(1));
            
            // 2. 稍难的四则运算（2星）
            currentQuestions.push(generateArithmeticQuestion(2));
            
            // 3. 单位换算（3星）
            currentQuestions.push(generateUnitConversionQuestion());
            
            // 4. 分数或小数计算（4星）
            currentQuestions.push(generateFractionDecimalQuestion());
            
            // 5. 简单方程（5星）
            currentQuestions.push(generateEquationQuestion());
            
            // 打乱题目顺序
            currentQuestions.sort(() => Math.random() - 0.5);
        }
        
        // 生成四则运算题目
        function generateArithmeticQuestion(level) {
            let num1, num2, operator, answer, question, explanation, difficulty;
            
            difficulty = level;
            
            switch(level) {
                case 1: // 简单
                    num1 = Math.floor(Math.random() * 10) + 1;
                    num2 = Math.floor(Math.random() * 10) + 1;
                    operators = ['+', '-'];
                    operator = operators[Math.floor(Math.random() * operators.length)];
                    break;
                    
                case 2: // 中等
                    num1 = Math.floor(Math.random() * 50) + 10;
                    num2 = Math.floor(Math.random() * 30) + 5;
                    operators = ['+', '-', '*'];
                    operator = operators[Math.floor(Math.random() * operators.length)];
                    break;
                    
                default:
                    num1 = Math.floor(Math.random() * 100) + 50;
                    num2 = Math.floor(Math.random() * 50) + 10;
                    operators = ['+', '-', '*', '/'];
                    operator = operators[Math.floor(Math.random() * operators.length)];
                    break;
            }
            
            // 确保减法结果为正
            if (operator === '-' && num1 < num2) {
                [num1, num2] = [num2, num1];
            }
            
            // 确保除法结果为整数
            if (operator === '/') {
                num2 = Math.floor(Math.random() * 10) + 1;
                num1 = num2 * (Math.floor(Math.random() * 10) + 1);
            }
            
            switch(operator) {
                case '+':
                    answer = num1 + num2;
                    explanation = `${num1} + ${num2} = ${answer}`;
                    break;
                case '-':
                    answer = num1 - num2;
                    explanation = `${num1} - ${num2} = ${answer}`;
                    break;
                case '*':
                    answer = num1 * num2;
                    explanation = `${num1} × ${num2} = ${answer}`;
                    break;
                case '/':
                    answer = num1 / num2;
                    explanation = `${num1} ÷ ${num2} = ${answer}`;
                    break;
            }
            
            question = `${num1} ${getOperatorSymbol(operator)} ${num2} = ?`;
            
            return {
                type: 'arithmetic',
                question: question,
                answer: answer.toString(),
                explanation: explanation,
                difficulty: difficulty,
                points: difficulty * 2
            };
        }
        
        // 获取运算符符号
        function getOperatorSymbol(operator) {
            switch(operator) {
                case '+': return '＋';
                case '-': return '－';
                case '*': return '×';
                case '/': return '÷';
                default: return operator;
            }
        }
        
        // 生成单位换算题目
        function generateUnitConversionQuestion() {
            const conversions = [
                { from: '厘米', to: '米', factor: 0.01, example: '100厘米 = 1米' },
                { from: '米', to: '千米', factor: 0.001, example: '1000米 = 1千米' },
                { from: '克', to: '千克', factor: 0.001, example: '1000克 = 1千克' },
                { from: '毫升', to: '升', factor: 0.001, example: '1000毫升 = 1升' },
                { from: '角', to: '元', factor: 0.1, example: '10角 = 1元' }
            ];
            
            const conversion = conversions[Math.floor(Math.random() * conversions.length)];
            const value = Math.floor(Math.random() * 10) * 100 + Math.floor(Math.random() * 100);
            const answer = (value * conversion.factor).toString();
            const question = `${value}${conversion.from} = ?${conversion.to}`;
            const explanation = `${value}${conversion.from} = ${value} × ${conversion.factor} = ${answer}${conversion.to}\n\n记住：${conversion.example}`;
            
            return {
                type: 'unit',
                question: question,
                answer: answer,
                explanation: explanation,
                difficulty: 3,
                points: 6
            };
        }
        
        // 生成分数或小数计算题目
        function generateFractionDecimalQuestion() {
            const type = Math.random() > 0.5 ? 'fraction' : 'decimal';
            
            if (type === 'fraction') {
                // 分数加法
                const num1 = Math.floor(Math.random() * 5) + 1;
                const den1 = Math.floor(Math.random() * 5) + 2;
                const num2 = Math.floor(Math.random() * 5) + 1;
                const den2 = den1; // 相同分母，简化计算
                
                const answer = (num1 + num2) / den1;
                const question = `${num1}/${den1} + ${num2}/${den2} = ?`;
                const explanation = `${num1}/${den1} + ${num2}/${den2} = (${num1} + ${num2})/${den1} = ${num1 + num2}/${den1} = ${answer}`;
                
                return {
                    type: 'fraction',
                    question: question,
                    answer: answer.toString(),
                    explanation: explanation,
                    difficulty: 4,
                    points: 8
                };
            } else {
                // 小数加减法
                const num1 = (Math.floor(Math.random() * 100) / 10).toFixed(1);
                const num2 = (Math.floor(Math.random() * 50) / 10).toFixed(1);
                const operator = Math.random() > 0.5 ? '+' : '-';
                
                let answer;
                if (operator === '+') {
                    answer = (parseFloat(num1) + parseFloat(num2)).toFixed(1);
                } else {
                    // 确保结果为正
                    if (parseFloat(num1) < parseFloat(num2)) {
                        [num1, num2] = [num2, num1];
                    }
                    answer = (parseFloat(num1) - parseFloat(num2)).toFixed(1);
                }
                
                const question = `${num1} ${getOperatorSymbol(operator)} ${num2} = ?`;
                const explanation = `${num1} ${getOperatorSymbol(operator)} ${num2} = ${answer}`;
                
                return {
                    type: 'decimal',
                    question: question,
                    answer: answer,
                    explanation: explanation,
                    difficulty: 4,
                    points: 8
                };
            }
        }
        
        // 生成简单方程题目
        function generateEquationQuestion() {
            const a = Math.floor(Math.random() * 5) + 2;
            const b = Math.floor(Math.random() * 10) + 5;
            const c = a * b;
            
            const question = `${a}x = ${c}，求x的值`;
            const answer = b.toString();
            const explanation = `${a}x = ${c}\n两边同时除以${a}：x = ${c} ÷ ${a} = ${b}`;
            
            return {
                type: 'equation',
                question: question,
                answer: answer,
                explanation: explanation,
                difficulty: 5,
                points: 10
            };
        }
        
        // 显示题目
        function showQuestion(index) {
            const question = currentQuestions[index];
            
            // 更新题目文本
            questionText.textContent = question.question;
            
            // 更新难度星级
            updateDifficultyStars(question.difficulty);
            
            // 更新当前题目编号
            currentQuestionSpan.textContent = index + 1;
            
            // 清空答案输入框
            answerInput.value = '';
            answerInput.focus();
            
            // 隐藏解析区域
            explanationContainer.classList.add('hidden');
            
            // 隐藏提示
            hintText.classList.add('hidden');
            
            // 重置输入框样式
            answerInput.classList.remove('border-success', 'border-danger', 'correct-animation', 'wrong-animation');
            
            // 添加滑入动画
            gsap.from('#questionText', {
                x: -50,
                opacity: 0,
                duration: 0.5,
                ease: 'power2.out'
            });
            
            gsap.from('#answerInput', {
                x: 50,
                opacity: 0,
                duration: 0.5,
                delay: 0.2,
                ease: 'power2.out'
            });
        }
        
        // 更新难度星级
        function updateDifficultyStars(level) {
            difficultyStars.innerHTML = '';
            
            for (let i = 0; i < 5; i++) {
                const star = document.createElement('i');
                star.className = `fa fa-star text-2xl mx-1 ${i < level ? 'text-secondary star-glow' : 'text-gray-300'}`;
                
                if (i < level) {
                    star.classList.add('twinkle');
                    star.style.animationDelay = `${i * 0.2}s`;
                }
                
                difficultyStars.appendChild(star);
            }
        }
        
        // 检查答案
        function checkAnswer() {
            const userAnswer = answerInput.value.trim();
            const question = currentQuestions[currentQuestionIndex];
            
            // 验证答案
            const isCorrect = isAnswerCorrect(userAnswer, question.answer);
            
            // 保存用户答案
            userAnswers.push({
                question: question.question,
                userAnswer: userAnswer,
                correctAnswer: question.answer,
                isCorrect: isCorrect,
                points: isCorrect ? question.points : 0
            });
            
            // 更新分数
            if (isCorrect) {
                score += question.points;
                totalScore += question.points;
                
                // 更新总分显示
                animateScoreChange();
                
                // 播放正确音效
                playSound(correctSound);
                
                // 显示正确动画
                answerInput.classList.remove('border-danger', 'wrong-animation');
                answerInput.classList.add('border-success', 'correct-animation');
                
                // 显示解析
                showExplanation(true);
            } else {
                // 播放错误音效
                playSound(wrongSound);
                
                // 显示错误动画
                answerInput.classList.remove('border-success', 'correct-animation');
                answerInput.classList.add('border-danger', 'wrong-animation');
                
                // 显示解析
                showExplanation(false);
            }
        }
        
        // 判断答案是否正确（考虑小数和分数的近似值）
        function isAnswerCorrect(userAnswer, correctAnswer) {
            // 转换为数字进行比较
            const userNum = parseFloat(userAnswer);
            const correctNum = parseFloat(correctAnswer);
            
            // 如果是整数，直接比较字符串
            if (Number.isInteger(correctNum)) {
                return userAnswer === correctAnswer;
            }
            
            // 如果是小数，允许一定的误差
            return Math.abs(userNum - correctNum) < 0.01;
        }
        
        // 显示解析
        function showExplanation(isCorrect) {
            const question = currentQuestions[currentQuestionIndex];
            
            // 设置解析文本
            let explanationHTML = `<div class="mb-3 ${isCorrect ? 'text-success' : 'text-danger'} font-bold">
                <i class="fa fa-${isCorrect ? 'check-circle' : 'times-circle'} mr-2"></i>
                ${isCorrect ? '回答正确！' : '回答错误！'}
            </div>`;
            
            explanationHTML += `<div class="mb-2">
                <strong>正确答案：</strong> ${question.answer}
            </div>`;
            
            explanationHTML += `<div>
                <strong>解析：</strong><br>
                ${question.explanation.replace(/\n/g, '<br>')}
            </div>`;
            
            explanationHTML += `<div class="mt-3 text-primary">
                <strong>得分：</strong> ${isCorrect ? question.points : 0}/${question.points} 分
            </div>`;
            
            explanationText.innerHTML = explanationHTML;
            
            // 显示解析区域
            explanationContainer.classList.remove('hidden');
            
            // 添加显示动画
            gsap.from('#explanationContainer', {
                y: 20,
                opacity: 0,
                duration: 0.5,
                ease: 'power2.out'
            });
        }
        
        // 下一题
        function nextQuestion() {
            playSound(buttonSound);
            
            currentQuestionIndex++;
            
            if (currentQuestionIndex < currentQuestions.length) {
                showQuestion(currentQuestionIndex);
            } else {
                showResult();
            }
        }
        
        // 显示结果
        function showResult() {
            playSound(successSound);
            
            // 隐藏题目界面，显示结果界面
            gsap.timeline()
                .to(quizScreen, {
                    opacity: 0,
                    y: -50,
                    duration: 0.5,
                    ease: 'power2.in'
                })
                .to(resultScreen, {
                    opacity: 1,
                    y: 0,
                    duration: 0.5,
                    ease: 'power2.out',
                    onComplete: () => {
                        quizScreen.classList.add('hidden');
                        resultScreen.classList.remove('hidden');
                        
                        // 更新最终得分
                        animateFinalScore();
                        
                        // 更新结果消息
                        updateResultMessage();
                    }
                });
        }
        
        // 动画显示最终得分
        function animateFinalScore() {
            let current = 0;
            const target = totalScore;
            const duration = 1500; // 1.5秒
            const increment = target / (duration / 16);
            
            const timer = setInterval(() => {
                current += increment;
                
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                
                finalScoreSpan.textContent = Math.floor(current);
            }, 16);
        }
        
        // 更新结果消息
        function updateResultMessage() {
            let message, color, icon;
            
            const percentage = (totalScore / 50) * 100;
            
            if (percentage >= 90) {
                message = '太棒了！你是数学小天才！';
                color = 'text-success';
                icon = 'fa-trophy';
            } else if (percentage >= 70) {
                message = '做得很好！继续保持！';
                color = 'text-primary';
                icon = 'fa-star';
            } else if (percentage >= 50) {
                message = '不错的尝试！再接再厉！';
                color = 'text-info';
                icon = 'fa-thumbs-up';
            } else {
                message = '加油！多练习就会进步！';
                color = 'text-warning';
                icon = 'fa-heart';
            }
            
            resultMessage.innerHTML = `<i class="fa ${icon} text-2xl mr-2"></i><span class="${color}">${message}</span>`;
            
            // 添加动画
            gsap.from('#resultMessage', {
                scale: 0.5,
                opacity: 0,
                duration: 0.5,
                delay: 1,
                ease: 'back.out(1.7)'
            });
        }
        
        // 切换答案回顾
        function toggleAnswersReview() {
            playSound(buttonSound);
            
            if (answersReview.classList.contains('hidden')) {
                // 生成答案列表
                generateAnswersList();
                
                // 显示答案回顾
                answersReview.classList.remove('hidden');
                
                // 更改按钮文本
                viewAnswersBtn.innerHTML = '<i class="fa fa-times mr-2"></i>隐藏答案';
                
                // 添加动画
                gsap.from('#answersReview', {
                    y: 50,
                    opacity: 0,
                    duration: 0.5,
                    ease: 'power2.out'
                });
            } else {
                // 隐藏答案回顾
                answersReview.classList.add('hidden');
                
                // 更改按钮文本
                viewAnswersBtn.innerHTML = '<i class="fa fa-list-alt mr-2"></i>查看答案';
            }
        }
        
        // 生成答案列表
        function generateAnswersList() {
            answersList.innerHTML = '';
            
            userAnswers.forEach((item, index) => {
                const questionItem = document.createElement('div');
                questionItem.className = `p-4 rounded-xl shadow-md ${item.isCorrect ? 'bg-green-50 border-l-4 border-success' : 'bg-red-50 border-l-4 border-danger'}`;
                
                questionItem.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="font-bold text-lg">
                            <span class="text-primary">#${index + 1}</span> ${item.question}
                        </div>
                        <span class="px-3 py-1 rounded-full text-white text-sm font-bold ${item.isCorrect ? 'bg-success' : 'bg-danger'}">
                            ${item.points}/${currentQuestions[index].points} 分
                        </span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        <div>
                            <strong>你的答案：</strong>
                            <span class="${item.isCorrect ? 'text-success' : 'text-danger font-bold'}">${item.userAnswer}</span>
                        </div>
                        <div>
                            <strong>正确答案：</strong>
                            <span class="text-success">${item.correctAnswer}</span>
                        </div>
                    </div>
                    <div class="mt-2 text-sm text-gray-600">
                        <strong>解析：</strong><br>
                        ${currentQuestions[index].explanation.replace(/\n/g, '<br>')}
                    </div>
                `;
                
                answersList.appendChild(questionItem);
            });
        }
        
        // 重新开始
        function restartQuiz() {
            playSound(buttonSound);
            
            // 隐藏结果界面，显示开始界面
            gsap.timeline()
                .to(resultScreen, {
                    opacity: 0,
                    y: 50,
                    duration: 0.5,
                    ease: 'power2.in'
                })
                .to(startScreen, {
                    opacity: 1,
                    y: 0,
                    duration: 0.5,
                    ease: 'power2.out',
                    onComplete: () => {
                        resultScreen.classList.add('hidden');
                        answersReview.classList.add('hidden');
                        startScreen.classList.remove('hidden');
                        
                        // 重置按钮文本
                        viewAnswersBtn.innerHTML = '<i class="fa fa-list-alt mr-2"></i>查看答案';
                    }
                });
        }
        
        // 切换音效
        function toggleSound() {
            soundEnabled = !soundEnabled;
            
            soundToggle.innerHTML = soundEnabled ? 
                '<i class="fa fa-volume-up"></i>' : 
                '<i class="fa fa-volume-off"></i>';
            
            // 添加动画
            gsap.fromTo(soundToggle, 
                { scale: 1.2, rotation: 0 },
                { scale: 1, rotation: 360, duration: 0.5, ease: 'power2.out' }
            );
        }
        
        // 播放音效
        function playSound(sound) {
            if (soundEnabled) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log('音效播放失败:', e));
            }
        }
        
        // 分数变化动画
        function animateScoreChange() {
            gsap.fromTo(totalScoreSpan, 
                { scale: 1.5, color: '#FFD54F' },
                { scale: 1, color: 'white', duration: 0.5, ease: 'elastic.out(1, 0.5)' }
            );
            
            totalScoreSpan.textContent = totalScore;
        }
        
        // 显示提示
        function showHint() {
            const question = currentQuestions[currentQuestionIndex];
            let hint = '';
            
            switch(question.type) {
                case 'arithmetic':
                    if (question.question.includes('＋')) {
                        hint = '提示：加法就是把两个数合起来';
                    } else if (question.question.includes('－')) {
                        hint = '提示：减法就是从一个数里去掉另一个数';
                    } else if (question.question.includes('×')) {
                        hint = '提示：乘法就是几个相同的数相加';
                    } else if (question.question.includes('÷')) {
                        hint = '提示：除法就是把一个数平均分成几份';
                    }
                    break;
                    
                case 'unit':
                    if (question.question.includes('厘米') && question.question.includes('米')) {
                        hint = '提示：1米 = 100厘米';
                    } else if (question.question.includes('米') && question.question.includes('千米')) {
                        hint = '提示：1千米 = 1000米';
                    } else if (question.question.includes('克') && question.question.includes('千克')) {
                        hint = '提示：1千克 = 1000克';
                    } else if (question.question.includes('毫升') && question.question.includes('升')) {
                        hint = '提示：1升 = 1000毫升';
                    } else if (question.question.includes('角') && question.question.includes('元')) {
                        hint = '提示：1元 = 10角';
                    }
                    break;
                    
                case 'fraction':
                    hint = '提示：同分母分数相加，分母不变，分子相加';
                    break;
                    
                case 'decimal':
                    hint = '提示：小数加减法要对齐小数点';
                    break;
                    
                case 'equation':
                    hint = '提示：两边同时除以系数就能得到x的值';
                    break;
                    
                default:
                    hint = '提示：仔细想想哦！';
            }
            
            hintText.textContent = hint;
            hintText.classList.remove('hidden');
            
            // 添加动画
            gsap.from('#hintText', {
                y: -20,
                opacity: 0,
                duration: 0.5,
                ease: 'power2.out'
            });
        }
        
        // 点击屏幕任意位置显示提示（3秒后）
        document.addEventListener('click', (e) => {
            if (!quizScreen.classList.contains('hidden') && 
                !explanationContainer.classList.contains('hidden') &&
                e.target !== hintText &&
                !hintText.contains(e.target)) {
                
                setTimeout(() => {
                    if (!hintText.classList.contains('hidden')) {
                        hintText.classList.add('hidden');
                    }
                }, 3000);
            }
        });
    </script>
</body>
</html>